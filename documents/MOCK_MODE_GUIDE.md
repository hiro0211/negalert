# 🎭 モックデータモード使用ガイド

AI機能をテストするために、モックデータで動作させることができます。

---

## 📋 概要

モックデータモードでは、以下のデータがモック（`lib/mock/reviews.ts`）から読み込まれます：

- ✅ レビュー一覧（Inbox）
- ✅ レビュー詳細
- ✅ 未返信レビュー
- ✅ ネガティブレビュー（★3以下）
- ✅ 高リスクレビュー
- ✅ **AI分析結果（既に含まれています）**

---

## 🚀 使い方

### ステップ1: モックモードを有効化

`.env.local` ファイルを開き、以下の行を確認・追加してください：

```bash
# モックデータモードを有効化
NEXT_PUBLIC_USE_MOCK_DATA=true

# Google Places API キー（実店舗データをインポートする場合）
GOOGLE_PLACES_API_KEY=your_api_key_here
```

**既に追加されています！**

### ステップ2: 開発サーバーを再起動

環境変数を変更したため、サーバーを再起動する必要があります。

```bash
# Ctrl+C で停止
npm run dev
```

### ステップ3: テストデータの準備（2つの方法）

モックモードでは、2つの方法でテストデータを用意できます：

#### 方法A: 実店舗のレビューをインポート（推奨）

1. http://localhost:3000/dashboard/settings にアクセス
2. **「テストデータ」タブ**を開く（モックモード時のみ表示）
3. Google Place IDを入力
   - 例: `ChIJR4fczVeLGGARWVp2HGalka0` (スターバックス渋谷店)
4. 「レビューをインポート」ボタンをクリック
5. インポート成功後、「ダッシュボードで確認」または「Inboxで確認」をクリック

**Place IDの探し方:**
- [Google Place ID Finder](https://developers.google.com/maps/documentation/javascript/examples/places-placeid-finder) にアクセス
- 店舗名や住所で検索してPlace IDをコピー

**メリット:**
- 実際の店舗レビューでテストできる
- 統計データやAI分析の精度を確認できる
- 様々な評価や長さのレビューで動作確認が可能

#### 方法B: デフォルトのモックデータを使用

1. http://localhost:3000/dashboard/inbox にアクセス
2. モックデータのレビュー一覧が表示されます（15件）
3. 任意のレビューの「詳細」ボタンをクリック
4. レビュー詳細画面が表示されます

**メリット:**
- すぐにテストを開始できる
- AI分析結果が事前に含まれている

### ステップ4: AI分析をテスト

#### パターンA: AI分析済みのレビューを表示

モックデータには既にAI分析結果が含まれています：

- **レビューID 1** (★2、田中太郎)
  - 要約: 接客態度と料理の品質に関する強い不満。早急な対応が必要。
  - カテゴリ: 接客、料理の質
  - リスク: high
  
- **レビューID 2** (★1、山田花子)
  - 要約: 予約管理と待ち時間に関する重大なクレーム。
  - カテゴリ: 予約管理、接客
  - リスク: high
  - 返信案: あり
  
- **レビューID 3** (★5、佐藤健一)
  - 要約: 非常に満足度の高いポジティブなレビュー。
  - カテゴリ: 接客、料理の質
  - リスク: low

👉 これらのレビューを開くと、AI分析結果が既に表示されます。

#### パターンB: AI分析を実行してみる

モックモードでも、「AI分析を実行」ボタンをクリックすることで、OpenAI APIを呼び出してリアルタイムにAI分析を実行できます。

**動作:**
1. レビュー詳細画面で「AI分析を実行」ボタンをクリック
2. OpenAI API (`gpt-4o-mini`) が呼び出される
3. AI分析結果が表示される
4. **ただし、DBには保存されません**（モックモードのため）
5. ページをリロードすると、元のモックデータに戻ります

---

## 🔍 モックモードの動作

### 何が動作するか

- ✅ レビュー一覧の表示（Supabaseから取得）
- ✅ レビュー詳細の表示
- ✅ フィルタリング（未返信、ネガティブ、高リスク）
- ✅ AI分析の実行（OpenAI API呼び出し）
- ✅ AI分析結果の表示
- ✅ **実店舗のレビューデータのインポート（新機能）**
- ✅ **ダッシュボードの統計表示（インポートデータ基準）**
- ✅ **週間レポートの生成（インポートデータ基準）**

### 何が動作しないか

- ❌ Google Business Profile APIからのレビュー同期
- ❌ レビューへの返信投稿（Google APIへの送信）
- ❌ 本番環境へのデプロイ時の動作

### サーバーログの確認

モックモード有効時、サーバーログに以下のような表示が出ます：

```
🎭 [MOCK MODE] モックデータを使用しています
🎭 [MOCK MODE] モックデータからレビューを検索: 1
🎭 [MOCK MODE] モックデータからレビューを取得
🎭 [MOCK MODE] DB更新をスキップ
🎭 [MOCK MODE] AI分析結果をマージしたモックデータを返す
```

---

## 📊 利用可能なモックレビュー

全15件のレビューが用意されています：

| ID | 評価 | 著者 | ステータス | リスク | AI分析 |
|----|------|------|-----------|--------|--------|
| 1 | ★2 | 田中太郎 | 未返信 | high | ✅ |
| 2 | ★1 | 山田花子 | 未返信 | high | ✅ (返信案あり) |
| 3 | ★5 | 佐藤健一 | 返信済 | low | ✅ |
| 4 | ★4 | 鈴木美咲 | 返信済 | low | ✅ |
| 5 | ★3 | 高橋誠 | 未返信 | medium | ✅ |
| 6 | ★5 | 渡辺由美 | 返信済 | low | ✅ |
| 7 | ★2 | 伊藤和也 | 自動返信 | medium | ✅ |
| 8 | ★4 | 小林真理子 | 返信済 | low | ✅ |
| 9 | ★5 | 中村隆 | 返信済 | low | ✅ |
| 10 | ★1 | 加藤直樹 | 未返信 | high | ✅ (返信案あり) |
| 11 | ★4 | 森田香織 | 返信済 | low | ✅ |
| 12 | ★3 | 石井大輔 | 返信済 | medium | ✅ |
| 13 | ★5 | 藤田結衣 | 返信済 | low | ✅ |
| 14 | ★2 | 岡田祐介 | 未返信 | medium | ✅ (返信案あり) |
| 15 | ★4 | 松本さくら | 返信済 | low | ✅ |

### おすすめテストシナリオ

#### シナリオ1: 高リスクレビューの確認
1. ID 1, 2, 10 のレビューを開く（全て★1-2、未返信）
2. AI分析結果を確認
3. 返信案が謝罪重視になっているか確認

#### シナリオ2: AI分析の実行
1. ID 5 のレビュー（★3、未返信）を開く
2. 「AI分析を実行」ボタンをクリック
3. OpenAI APIが呼び出されることを確認
4. 新しい分析結果が表示されることを確認

#### シナリオ3: 高評価レビューの確認
1. ID 3, 6, 9 のレビューを開く（全て★5）
2. AI分析結果を確認
3. 返信案が感謝重視になっているか確認

---

## 🔄 元に戻す方法

### モックモードを無効化

`.env.local` ファイルを開き、以下のように変更してください：

```bash
# モックデータモードを無効化（実データを使用）
NEXT_PUBLIC_USE_MOCK_DATA=false

# または、行をコメントアウト
# NEXT_PUBLIC_USE_MOCK_DATA=true
```

### 開発サーバーを再起動

```bash
# Ctrl+C で停止
npm run dev
```

これで、Supabaseの実データが使用されるようになります。

---

## 🐛 トラブルシューティング

### モックデータが表示されない

**原因**: 環境変数が読み込まれていない

**解決方法**:
1. `.env.local` ファイルを確認
2. `NEXT_PUBLIC_USE_MOCK_DATA=true` が記述されているか確認
3. **重要**: `NEXT_PUBLIC_` プレフィックスが必要（クライアントサイドで読み取るため）
4. 開発サーバーを**必ず再起動**

### AI分析が動作しない

**原因**: OpenAI APIキーが設定されていない

**解決方法**:
1. `.env.local` ファイルを確認
2. `OPENAI_API_KEY=sk-...` が記述されているか確認
3. APIキーが有効であることを確認
4. 開発サーバーを再起動

### 「テストデータ」タブが表示されない

**原因**: モックモードが無効になっている

**解決方法**:
1. `.env.local` で `NEXT_PUBLIC_USE_MOCK_DATA=true` が設定されているか確認
2. 開発サーバーを再起動
3. ブラウザをリロード（Ctrl + Shift + R）

### Place IDインポートで「NOT_FOUND」エラー

**原因**: Place IDが無効、またはAPIキーが未設定

**解決方法**:
1. Place IDが正しいか確認（`ChIJ...` で始まる文字列）
2. [Google Place ID Finder](https://developers.google.com/maps/documentation/javascript/examples/places-placeid-finder) で正しいPlace IDを取得
3. `.env.local` に `GOOGLE_PLACES_API_KEY` が設定されているか確認
4. Google Cloud ConsoleでPlaces APIが有効になっているか確認

### Place IDインポートで「No workspace found」エラー

**原因**: ワークスペースが作成されていない

**解決方法**:
1. Supabaseの `workspaces` テーブルを確認
2. 手動でワークスペースを作成:
   ```sql
   INSERT INTO workspaces (user_id, name, google_location_id)
   VALUES ('your-user-id', 'テスト店舗', 'test-location-001');
   ```
3. 再度インポートを実行

### インポートしたレビューが表示されない

**解決方法**:
1. ブラウザを完全リロード（Ctrl + Shift + R）
2. `/dashboard/inbox` に直接アクセス
3. サーバーログを確認（レビュー取得のログが出ているか）

---

## 📝 コード参照

モックモードの実装は以下のファイルで確認できます：

### 主要ファイル

1. **環境変数**: `.env.local`
   ```bash
   NEXT_PUBLIC_USE_MOCK_DATA=true
   ```

2. **データ取得**: `lib/api/reviews.ts`
   ```typescript
   const USE_MOCK_DATA = process.env.NEXT_PUBLIC_USE_MOCK_DATA === 'true';
   
   if (USE_MOCK_DATA) {
     console.log('🎭 [MOCK MODE] モックデータを使用しています');
     return Promise.resolve([...mockReviews]);
   }
   ```

3. **APIエンドポイント**: `app/api/reviews/[id]/analyze/route.ts`
   ```typescript
   if (USE_MOCK_DATA) {
     console.log('🎭 [MOCK MODE] モックデータからレビューを取得');
     const mockReview = getMockReviewById(id);
     // ...
   }
   ```

4. **モックデータ**: `lib/mock/reviews.ts`
   - 15件のレビュー
   - 全てにAI分析結果が含まれる

---

## ✅ チェックリスト

### 基本セットアップ

- [ ] `.env.local` に `NEXT_PUBLIC_USE_MOCK_DATA=true` が記述されている
- [ ] `.env.local` に `OPENAI_API_KEY=sk-...` が記述されている
- [ ] 開発サーバーを再起動した

### 実店舗データインポート（推奨）

- [ ] `.env.local` に `GOOGLE_PLACES_API_KEY` が設定されている
- [ ] Supabaseに `workspaces` テーブルのレコードが存在する
- [ ] 設定ページの「テストデータ」タブが表示される
- [ ] Place IDを入力してインポートが成功した
- [ ] ダッシュボードで統計データが表示される
- [ ] Inboxでインポートしたレビューが表示される

### デフォルトモックデータ使用

- [ ] ブラウザで http://localhost:3000/dashboard/inbox にアクセスできる
- [ ] レビュー一覧にモックレビューが表示される
- [ ] AI分析が実行できる

---

## 🎯 まとめ

モックデータモードを使うことで：

✅ **実データに影響を与えずに**AI機能をテストできる  
✅ **実店舗のレビューデータ**で実践的なテストができる（新機能）  
✅ **ダッシュボード統計**や**週間レポート**の動作を確認できる  
✅ **OpenAI APIの実際の動作**を確認できる  
✅ **簡単に元に戻せる**（環境変数を変更するだけ）

### 推奨テストフロー

1. モックモードを有効化（`NEXT_PUBLIC_USE_MOCK_DATA=true`）
2. 設定ページで実店舗のPlace IDをインポート
3. ダッシュボードで統計情報を確認
4. Inboxでレビュー一覧を確認
5. AI分析・週間レポート機能をテスト
6. テスト完了後、`NEXT_PUBLIC_USE_MOCK_DATA=false` に戻す

テストが終わったら、必ず `.env.local` で `NEXT_PUBLIC_USE_MOCK_DATA=false` に戻してください！
